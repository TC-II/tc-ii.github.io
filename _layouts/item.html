---
layout: default
---

<main class="container after-header">
  <article class="item card">

    <!-- Título -->
    <h1 class="title-lg">{{ page.title }}</h1>

    <!-- Meta/chips -->
    <div class="meta small text-dim" style="margin-top:.25rem">
      {% if page.tipo %}<span class="pill">{{ page.tipo }}</span>{% endif %}
      {% if page.unidad %} · Unidad: {{ page.unidad }}{% endif %}
      {% if page.tema %} · Tema: {{ page.tema }}{% endif %}
      {% if page.fecha %} · {{ page.fecha | date: "%d/%m/%Y" }}{% endif %}
    </div>

    <!-- Sección “Contenido” -->
    <div class="card soft" style="margin-top:1rem">
      <strong>Contenido</strong>
    </div>

    {% if page.descripcion %}
      <p class="lead" style="margin-top:1rem">{{ page.descripcion }}</p>
    {% endif %}

    <!-- Markdown del documento (opcional) -->
    <div class="prose">
      {{ content }}
    </div>

    {% if page.archivo %}
      <!-- Acciones -->
      <div class="actions" style="gap:.5rem; margin:.75rem 0 1rem 0">
        <a class="btn" href="{{ page.archivo | relative_url }}" download>Descargar PDF</a>
        <a class="btn ghost" href="{{ page.archivo | relative_url }}" target="_blank" rel="noopener">Abrir en pestaña</a>
      </div>

      <!-- Visor PDF con fallback móvil -->
      <div id="pdfWrapper" class="pdf-fit card">
        <iframe
          id="pdfFrame"
          title="Visor PDF"
          data-pdf="{{ page.archivo | replace: '\','/' | relative_url }}">
        </iframe>
      </div>

      <p class="small text-dim" style="margin-top:1rem">
        Si el visor no carga, usá “Abrir en pestaña” o “Descargar PDF”.
      </p>
    {% endif %}

  </article>
</main>

{%- comment -%}
  JS: visor con fallback (iOS/Safari o si el navegador no embebe PDF).
  - Desktop/Android: visor nativo (#view=FitH)
  - iOS/Safari o si falla: Google Docs Viewer dentro del iframe
{%- endcomment -%}
<script>
(function initPdfViewer(){
  const frame = document.getElementById('pdfFrame');
  if(!frame) return;

  const pdfUrl = frame.getAttribute('data-pdf');
  if(!pdfUrl) return;

  // Detección simple
  const ua = navigator.userAgent || '';
  const isIOS =
    /iPad|iPhone|iPod/.test(ua) ||
    (navigator.platform === 'MacIntel' && navigator.maxTouchPoints > 1);
  const isSafari = /^((?!chrome|android).)*safari/i.test(ua);

  // URLs
  const nativeUrl = pdfUrl + '#view=FitH';
  const absolute  = new URL(pdfUrl, window.location.origin).href; // compat total
  const gdocsUrl  = 'https://docs.google.com/viewer?embedded=true&url=' + encodeURIComponent(absolute);

  // iOS/Safari: ir directo a Google Viewer
  if (isIOS || isSafari) {
    frame.src = gdocsUrl;
    frame.dataset.external = 'gdocs';
    return;
  }

  // Intento nativo primero
  frame.src = nativeUrl;

  // Fallback si no carga a tiempo (content-type, etc.)
  let loaded = false;
  const fallbackTimer = setTimeout(() => {
    if (!loaded) {
      frame.src = gdocsUrl;
      frame.dataset.external = 'gdocs';
    }
  }, 1500);

  frame.addEventListener('load', () => {
    loaded = true;
    clearTimeout(fallbackTimer);
  }, { once: true });
})();

// Controles de zoom / fullscreen (si los llamás desde botones)
function setPdfZoom(z) {
  const f = document.getElementById('pdfFrame');
  if (!f) return;
  if (f.dataset.external === 'gdocs') return; // en Google Viewer el hash no aplica
  const base = f.src.split('#')[0];
  f.src = base + '#zoom=' + encodeURIComponent(z) + '&view=FitH';
}

function toggleFull() {
  const wrap = document.getElementById('pdfWrapper');
  if (!wrap) return;
  if (!document.fullscreenElement) {
    if (wrap.requestFullscreen) wrap.requestFullscreen();
  } else {
    if (document.exitFullscreen) document.exitFullscreen();
  }
}
</script>
